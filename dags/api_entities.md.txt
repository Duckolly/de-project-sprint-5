Список полей, необходимых для витрины, включает:

id serial4 NOT NULL, — уникальный идентификатор записи.

courier_id varchar NOT NULL, — идентификатор курьера из внешней системы, используемый для создания отчета.

courier_name varchar NOT NULL, — имя и фамилия курьера.

settlement_year int4 NOT NULL, — год отчета (диапазон проверки: от 2022 до 2500).

settlement_month int4 NOT NULL, — месяц отчета, где 1 — январь и 12 — декабрь (диапазон проверки: от 1 до 12).

orders_count int4 DEFAULT 0 NOT NULL, — количество заказов за отчетный месяц.

orders_total_sum numeric(14, 2) DEFAULT 0::numeric NOT NULL, — общая стоимость заказов.

rate_avg numeric NOT NULL, — средний рейтинг курьера, основанный на оценках пользователей.

order_processing_fee numeric(14, 2) DEFAULT 0::numeric NOT NULL, — сумма, удержанная компанией за обработку заказов, которая рассчитывается как 25% от общей стоимости заказов (orders_total_sum * 0.25).

courier_order_sum numeric(14, 2) DEFAULT 0::numeric NOT NULL, — сумма, подлежащая выплате курьеру за доставленные заказы. Выплата зависит от рейтинга курьера по следующим правилам:

r < 4: 5% от стоимости заказа, но не менее 100 руб.;
4 <= r < 4.5: 7% от стоимости заказа, но не менее 150 руб.;
4.5 <= r < 4.9: 8% от стоимости заказа, но не менее 175 руб.;
r >= 4.9: 10% от стоимости заказа, но не менее 200 руб.
courier_tips_sum numeric(14, 2) DEFAULT 0::numeric NOT NULL, — сумма чаевых, оставленных пользователями курьеру.

courier_reward_sum numeric(14, 2) DEFAULT 0::numeric NOT NULL, — итоговая сумма, подлежащая выплате курьеру, рассчитывается как courier_order_sum + 95% от суммы чаевых (courier_tips_sum * 0.95, где 5% — комиссия за обработку платежа).

Список таблиц в слое DDS, из которых берутся данные для витрины. Таблицы уже имеются в хранилище:

dds.dm_timestamps (timestamp_id, year, month) — календарь с датами.
dds.dm_orders (order_id, order_status) — заказы со ссылкой на календарь, статусы заказов (обнаружено, что есть доставки и на закрытые заказы).
Добавлены в проекте (не было — созданы):

dds.dm_couriers — список курьеров:

id — идентификатор (ключ DDS);
courier_id — идентификатор курьера из внешней системы;
courier_name — имя и фамилия курьера.
dds.dm_deliveries — список доставок с атрибутами:

id — идентификатор (ключ DDS);
courier_id — связь с таблицей курьеров;
order_id — связь с таблицей заказов;
delivery_key — идентификатор доставки из внешней системы;
delivery_ts — дата и время доставки;
address — адрес доставки;
rate — рейтинг, поставленный курьеру;
tip_sum — сумма чаевых;
total_sum — общая сумма заказа в доставке.
На основе списка таблиц в DDS составляется список сущностей и полей, которые необходимо загрузить из API. Поля и сущности перечислены в п.2. В API соответственно:

/couriers:

_id — ID курьера в БД;
name — имя курьера.
/deliveries:

order_id — ID заказа;
order_ts — дата и время создания заказа;
delivery_id — ID доставки;
courier_id — ID курьера;
address — адрес доставки;
delivery_ts — дата и время доставки;
rate — рейтинг доставки, целочисленное значение от 1 до 5;
tip_sum — сумма чаевых, оставленных покупателем курьеру (в рублях);
sum — сумма заказа.






